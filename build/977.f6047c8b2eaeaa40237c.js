"use strict";(self.webpackChunkpayload_nextjs_server=self.webpackChunkpayload_nextjs_server||[]).push([[977],{36977:(e,l,a)=>{a.r(l),a.d(l,{default:()=>T});var t=a(67294),o=a(38439),s=a(28630),n=a(91455),d=a(40684),r=a(90546),i=a.n(r),c=a(77329),u=a(87578),p=a(45074),m=a(64012),v=a(19826),f=a(78285),b=a(90666),h=a(48170),y=a(95050),E=a(98851),w=a(35193),k=a(54945),g=a(77070),x=a(9684);a(53739);const R="field-type blocks",_={singular:"Block",plural:"Blocks"},T=i()((e=>{const{label:l,name:a,path:r,blocks:i,labels:T=_,fieldTypes:C,maxRows:Z,minRows:I,required:S,validate:D=w.blocks,permissions:O,admin:{readOnly:A,description:P,condition:F,className:L}}=e,M=r||a,{preferencesKey:$}=(0,p.x5)(),{getPreference:B,setPreference:N}=(0,n.G)(),[V,j]=(0,t.useReducer)(u.Z,[]),q=(0,m.useForm)(),{user:W}=(0,s.a)(),{id:z}=(0,p.x5)(),K=(0,d.bU)(),G=(0,x.T)(),{dispatchFields:U}=q,H=(0,t.useCallback)(((e,l)=>D(e,{...l,minRows:I,maxRows:Z,required:S})),[Z,I,S,D]),[J,Q]=(0,t.useState)(!1),{showError:X,errorMessage:Y,value:ee,setValue:le}=(0,h.Z)({path:M,validate:H,disableFormData:J,condition:F}),ae=(0,t.useCallback)((async(e,l)=>{const a=i.find((e=>e.slug===l)),t=await(0,v.Z)({fieldSchema:a.fields,operation:G,id:z,user:W,locale:K});U({type:"ADD_ROW",rowIndex:e,subFieldState:t,path:M,blockType:l}),j({type:"ADD",rowIndex:e,blockType:l}),le(ee+1)}),[M,le,ee,i,U,G,z,W,K]),te=(0,t.useCallback)((e=>{j({type:"REMOVE",rowIndex:e}),U({type:"REMOVE_ROW",rowIndex:e,path:M}),le(ee-1)}),[M,le,ee,U]),oe=(0,t.useCallback)(((e,l)=>{j({type:"MOVE",moveFromIndex:e,moveToIndex:l}),U({type:"MOVE_ROW",moveFromIndex:e,moveToIndex:l,path:M})}),[j,U,M]),se=(0,t.useCallback)((async(e,l)=>{var a,t,o;if(j({type:"SET_COLLAPSE",id:e,collapsed:l}),$){const s=await B($)||{fields:{}};let n=(null===(t=null===(a=null==s?void 0:s.fields)||void 0===a?void 0:a[M])||void 0===t?void 0:t.collapsed.filter((e=>V.find((l=>l.id===e)))))||[];l?n.push(e):n=n.filter((l=>l!==e)),N($,{...s,fields:{...(null==s?void 0:s.fields)||{},[M]:{...null===(o=null==s?void 0:s.fields)||void 0===o?void 0:o[M],collapsed:n}}})}}),[$,B,M,N,V]),ne=(0,t.useCallback)((e=>{if(!e.destination)return;const l=e.source.index,a=e.destination.index;oe(l,a)}),[oe]);(0,t.useEffect)((()=>{const e=q.getDataByPath(M);if(Array.isArray(e)){(async()=>{var l,a;const t=$?await B($):void 0;j({type:"SET_ALL",data:e||[],collapsedState:null===(a=null===(l=null==t?void 0:t.fields)||void 0===l?void 0:l[M])||void 0===a?void 0:a.collapsed})})()}}),[q,M,$,B]),(0,t.useEffect)((()=>{const e=q.getDataByPath(M);j({type:"SET_ALL",data:e||[]})}),[q,M]),(0,t.useEffect)((()=>{le((null==V?void 0:V.length)||0,!0),0===(null==V?void 0:V.length)?Q(!1):Q(!0)}),[V,le]);const de=Z&&V.length>=Z,re=[R,L].filter(Boolean).join(" ");return t.createElement(o.Z5,{onDragEnd:ne},t.createElement("div",{className:re},t.createElement("div",{className:`${R}__error-wrap`},t.createElement(b.Z,{showError:X,message:Y})),t.createElement("header",{className:`${R}__header`},t.createElement("h3",null,l),t.createElement(g.Z,{value:ee,description:P})),t.createElement(o.bK,{droppableId:"blocks-drop",isDropDisabled:A},(e=>t.createElement("div",{ref:e.innerRef,...e.droppableProps},V.length>0&&V.map(((e,l)=>{var a;const{blockType:o}=e,s=i.find((e=>e.slug===o));return s?t.createElement(f.Z,{readOnly:A,key:e.id,id:e.id,blockType:"blocks",blocks:i,label:null===(a=null==s?void 0:s.labels)||void 0===a?void 0:a.singular,isCollapsed:e.collapsed,rowCount:V.length,rowIndex:l,addRow:ae,removeRow:te,moveRow:oe,setRowCollapse:se,parentPath:M,fieldTypes:C,permissions:O,hasMaxRows:de,fieldSchema:[...s.fields]}):null})),(V.length<I||S&&0===V.length)&&t.createElement(k.Z,{type:"error"},"This field requires at least"," ",`${I||1} ${1===I||void 0===I?T.singular:T.plural}`),0===V.length&&A&&t.createElement(k.Z,null,"This field has no"," ",T.plural,"."),e.placeholder))),!A&&(V.length<Z||void 0===Z)&&t.createElement("div",{className:`${R}__add-button-wrap`},t.createElement(y.Z,{buttonType:"custom",size:"large",horizontalAlign:"left",button:t.createElement(c.Z,{buttonStyle:"icon-label",icon:"plus",iconPosition:"left",iconStyle:"with-border"},`Add ${T.singular}`),render:({close:e})=>t.createElement(E.Z,{blocks:i,addRow:ae,addRowIndex:ee,close:e})}))))}))}}]);