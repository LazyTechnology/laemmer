(self.webpackChunkpayload_nextjs_server=self.webpackChunkpayload_nextjs_server||[]).push([[783],{52149:(e,t,n)=>{"use strict";function o(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}n.d(t,{Z:()=>o})},84129:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var o=n(19013),a=n(13882);function r(e,t){(0,a.Z)(2,arguments);var n=(0,o.default)(e),r=(0,o.default)(t),s=n.getFullYear()-r.getFullYear(),i=n.getMonth()-r.getMonth();return 12*s+i}},83894:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var o=n(19013),a=n(13882);function r(e){(0,a.Z)(1,arguments);var t=(0,o.default)(e);return t.setHours(23,59,59,999),t}},4135:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var o=n(19013),a=n(13882);function r(e){(0,a.Z)(1,arguments);var t=(0,o.default)(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}},17095:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var o=n(19013),a=n(13882);function r(e,t){(0,a.Z)(2,arguments);var n=(0,o.default)(e),r=(0,o.default)(t),s=n.getTime()-r.getTime();return s<0?-1:s>0?1:s}var s=n(84129),i=n(83894),l=n(4135);function u(e){(0,a.Z)(1,arguments);var t=(0,o.default)(e);return(0,i.default)(t).getTime()===(0,l.default)(t).getTime()}function c(e,t){(0,a.Z)(2,arguments);var n,i=(0,o.default)(e),l=(0,o.default)(t),c=r(i,l),d=Math.abs((0,s.default)(i,l));if(d<1)n=0;else{1===i.getMonth()&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-c*d);var f=r(i,l)===-c;u((0,o.default)(e))&&1===d&&1===r(e,l)&&(f=!1),n=c*(d-Number(f))}return 0===n?0:n}function d(e,t){return(0,a.Z)(2,arguments),(0,o.default)(e).getTime()-(0,o.default)(t).getTime()}var f={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}};function v(e){return e?f[e]:f.trunc}function h(e,t,n){(0,a.Z)(2,arguments);var o=d(e,t)/1e3;return v(null==n?void 0:n.roundingMethod)(o)}var p=n(4958),m=n(52149);function b(e){return(0,m.Z)({},e)}var y=n(24262),g=1440,w=43200;var C=n(5977),k=n(39249),E=n(67294),_=n(9980),M=n(64012),Z=n(40684),$=n(56490),D=n(45074),S=n(25185);n(41263);const T=({collection:e,global:t,id:n,publishedDocUpdatedAt:s})=>{var i,l,u,d;const{serverURL:f,routes:{api:v,admin:m}}=(0,_.Z)(),{versions:T,getVersions:N}=(0,D.x5)(),{fields:U,dispatchFields:x}=(0,M.useWatchForm)(),O=(0,M.useFormModified)(),A=(0,Z.bU)(),{replace:P}=(0,C.k6)();let j=800;(null==e?void 0:e.versions.drafts)&&(null===(l=null===(i=e.versions)||void 0===i?void 0:i.drafts)||void 0===l?void 0:l.autosave)&&(j=e.versions.drafts.autosave.interval),(null==t?void 0:t.versions.drafts)&&(null===(d=null===(u=t.versions)||void 0===u?void 0:u.drafts)||void 0===d?void 0:d.autosave)&&(j=t.versions.drafts.autosave.interval);const[F,L]=(0,E.useState)(!1),[R,B]=(0,E.useState)(),X=(0,S.Z)(U,j),Y=(0,E.useRef)(U);Y.current=U;const V=(0,E.useCallback)((async()=>{const t=await fetch(`${f}${v}/${e.slug}?locale=${A}&fallback-locale=null&depth=0&draft=true`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(201===t.status){const n=await t.json();P(`${m}/collections/${e.slug}/${n.doc.id}`,{state:{data:n.doc}})}else k.Am.error("There was a problem while autosaving this document.")}),[e,f,v,m,A,P]);return(0,E.useEffect)((()=>{!n&&e&&V()}),[n,e,V]),(0,E.useEffect)((()=>{(async()=>{if(O){let o,a;if(L(!0),e&&n&&(o=`${f}${v}/${e.slug}/${n}?draft=true&autosave=true&locale=${A}`,a="PUT"),t&&(o=`${f}${v}/globals/${t.slug}?draft=true&autosave=true&locale=${A}`,a="POST"),o){const e={...(0,$.Z)(Y.current),_status:"draft"};setTimeout((async()=>{const t=await fetch(o,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});L(!1),200===t.status&&(B((new Date).getTime()),N())}),1e3)}}})()}),[X,O,f,v,e,t,n,x,N,A]),(0,E.useEffect)((()=>{var e;(null===(e=null==T?void 0:T.docs)||void 0===e?void 0:e[0])?B(new Date(T.docs[0].updatedAt).getTime()):s&&B(new Date(s).getTime())}),[s,T]),E.createElement("div",{className:"autosave"},F&&"Saving...",!F&&R&&E.createElement(E.Fragment,null,"Last saved ",function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,a.Z)(2,arguments);var s=n.locale||p.Z;if(!s.formatDistance)throw new RangeError("locale must contain formatDistance property");var i=r(e,t);if(isNaN(i))throw new RangeError("Invalid time value");var l,u,d=b(n);d.addSuffix=Boolean(n.addSuffix),d.comparison=i,i>0?(l=(0,o.default)(t),u=(0,o.default)(e)):(l=(0,o.default)(e),u=(0,o.default)(t));var f,v=h(u,l),m=((0,y.Z)(u)-(0,y.Z)(l))/1e3,C=Math.round((v-m)/60);if(C<2)return n.includeSeconds?v<5?s.formatDistance("lessThanXSeconds",5,d):v<10?s.formatDistance("lessThanXSeconds",10,d):v<20?s.formatDistance("lessThanXSeconds",20,d):v<40?s.formatDistance("halfAMinute",null,d):v<60?s.formatDistance("lessThanXMinutes",1,d):s.formatDistance("xMinutes",1,d):0===C?s.formatDistance("lessThanXMinutes",1,d):s.formatDistance("xMinutes",C,d);if(C<45)return s.formatDistance("xMinutes",C,d);if(C<90)return s.formatDistance("aboutXHours",1,d);if(C<g){var k=Math.round(C/60);return s.formatDistance("aboutXHours",k,d)}if(C<2520)return s.formatDistance("xDays",1,d);if(C<w){var E=Math.round(C/g);return s.formatDistance("xDays",E,d)}if(C<86400)return f=Math.round(C/w),s.formatDistance("aboutXMonths",f,d);if((f=c(u,l))<12){var _=Math.round(C/w);return s.formatDistance("xMonths",_,d)}var M=f%12,Z=Math.floor(f/12);return M<3?s.formatDistance("aboutXYears",Z,d):M<9?s.formatDistance("overXYears",Z,d):s.formatDistance("almostXYears",Z+1,d)}(new Date,new Date(R))," ago"))}},4983:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(67294),a=n(28630),r=n(77329),s=n(40684);n(33427);const i=e=>{const{generatePreviewURL:t,data:n}=e,[i,l]=(0,o.useState)(void 0),u=(0,s.bU)(),{token:c}=(0,a.a)();return(0,o.useEffect)((()=>{if(t&&"function"==typeof t){(async()=>{const e=await t(n,{locale:u,token:c});l(e)})()}}),[t,u,c,n]),i?o.createElement(r.Z,{el:"anchor",className:"preview-btn",buttonStyle:"secondary",url:i,newTab:!0},"Preview"):null}},11750:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var o=n(67294),a=n(46268),r=n(45074),s=n(64012);const i=()=>{const{unpublishedVersions:e,publishedDoc:t}=(0,r.x5)(),{submit:n}=(0,s.useForm)(),i=(0,s.useFormModified)(),l=(null==e?void 0:e.totalDocs)>0,u=i||l||!t,c=(0,o.useCallback)((()=>{n({overrides:{_status:"published"}})}),[n]);return o.createElement(a.Z,{type:"button",onClick:c,disabled:!u},"Publish changes")}},8792:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var o=n(67294),a=n(9980),r=n(46268),s=n(64012),i=n(45074),l=n(40684);n(79129);const u=()=>{const{serverURL:e,routes:{api:t}}=(0,a.Z)(),{submit:n}=(0,s.useForm)(),{collection:u,global:c,id:d}=(0,i.x5)(),f=(0,s.useFormModified)(),v=(0,l.bU)(),h=f,p=(0,o.useCallback)((()=>{const o=`?locale=${v}&depth=0&fallback-locale=null&draft=true`;let a,r="POST";u&&(a=`${e}${t}/${u.slug}${d?`/${d}`:""}${o}`,d&&(r="PUT")),c&&(a=`${e}${t}/globals/${c.slug}${o}`),n({action:a,method:r,skipValidation:!0,overrides:{_status:"draft"}})}),[n,u,c,e,t,v,d]);return o.createElement(r.Z,{className:"save-draft",type:"button",buttonStyle:"secondary",onClick:p,disabled:!h},"Save draft")}},24531:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var o=n(67294),a=n(39249),r=n(71851),s=n(9980),i=n(45074),l=n(77329),u=n(39599),c=n(93780),d=n(64012),f=n(40684);n(22118);const v="status",h="confirm-un-publish",p="confirm-revert",m=()=>{var e,t;const{publishedDoc:n,unpublishedVersions:m,collection:b,global:y,id:g,getVersions:w}=(0,i.x5)(),{toggle:C,closeAll:k}=(0,r.useModal)(),{serverURL:E,routes:{api:_}}=(0,s.Z)(),[M,Z]=(0,o.useState)(!1),{reset:$}=(0,d.useForm)(),D=(0,f.bU)();let S;(null===(e=null==m?void 0:m.docs)||void 0===e?void 0:e.length)>0&&n?S="Changed":n?n&&(null===(t=null==m?void 0:m.docs)||void 0===t?void 0:t.length)<=1&&(S="Published"):S="Draft";const T=(0,o.useCallback)((async e=>{let t,o,r;Z(!0),"unpublish"===e&&(r={_status:"draft"}),"revert"===e&&(r=n),b&&(t=`${E}${_}/${b.slug}/${g}?depth=0&locale=${D}&fallback-locale=null`,o="put"),y&&(t=`${E}${_}/globals/${y.slug}?depth=0&locale=${D}&fallback-locale=null`,o="post");const s=await c.E[o](t,{headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(200===s.status){let e,t;const n=await s.json();y&&(e=n.result,t=y.fields),b&&(e=n.doc,t=b.fields),$(t,e),a.Am.success(n.message),w()}else a.Am.error("There was a problem while un-publishing this document.");Z(!1),k()}),[k,b,y,E,_,$,g,D,w,n]);return S?o.createElement("div",{className:v},o.createElement("div",{className:"status__value-wrap"},o.createElement("span",{className:"status__value"},S),"Published"===S&&o.createElement(o.Fragment,null," — ",o.createElement(l.Z,{onClick:()=>C(h),className:"status__action",buttonStyle:"none"},"Unpublish"),o.createElement(r.Modal,{slug:h,className:"status__modal"},o.createElement(u.Z,null,o.createElement("h1",null,"Confirm unpublish"),o.createElement("p",null,"You are about to unpublish this document. Are you sure?"),o.createElement(l.Z,{buttonStyle:"secondary",type:"button",onClick:M?void 0:()=>C(h)},"Cancel"),o.createElement(l.Z,{onClick:M?void 0:()=>T("unpublish")},M?"Unpublishing...":"Confirm")))),"Changed"===S&&o.createElement(o.Fragment,null," — ",o.createElement(l.Z,{onClick:()=>C(p),className:"status__action",buttonStyle:"none"},"Revert to published"),o.createElement(r.Modal,{slug:p,className:"status__modal"},o.createElement(u.Z,null,o.createElement("h1",null,"Confirm revert to saved"),o.createElement("p",null,"You are about to revert this document's changes to its published state. Are you sure?"),o.createElement(l.Z,{buttonStyle:"secondary",type:"button",onClick:M?void 0:()=>C(p)},"Cancel"),o.createElement(l.Z,{onClick:M?void 0:()=>T("revert")},M?"Reverting...":"Confirm")))))):null}},8742:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var o=n(67294),a=n(9980),r=n(77329),s=n(45074),i=n(43442);n(80351);const l="versions-count",u=({collection:e,global:t,id:n})=>{var u,c,d;const{routes:{admin:f}}=(0,a.Z)(),{versions:v,publishedDoc:h,unpublishedVersions:p}=(0,s.x5)(),m=(null===(d=null===(c=null===(u=null==p?void 0:p.docs)||void 0===u?void 0:u[0])||void 0===c?void 0:c.version)||void 0===d?void 0:d._status)||(null==h?void 0:h._status)||"draft";let b,y;e&&(b=`${f}/collections/${e.slug}/${n}/versions`,y=e),t&&(b=`${f}/globals/${t.slug}/versions`,y=t);let g=0;(0,i.y)({entity:y,versions:v,docStatus:m})&&(g=1);const w=((null==v?void 0:v.totalDocs)||0)+g;return o.createElement("div",{className:l},0===w&&"No versions found",w>0&&o.createElement(r.Z,{className:`${l}__button`,buttonStyle:"none",el:"link",to:b},w," ","version",w>1&&"s"," ","found"))}},50854:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var o=n(67294),a=n(82949),r=n.n(a),s=n(28630),i=n(64012),l=n(39599),u=n(77329);n(22300);const c=()=>{const e=(0,i.useFormModified)(),{user:t}=(0,s.a)();return o.createElement(r(),{when:Boolean(e&&t)},(({onConfirm:e,onCancel:t})=>o.createElement("div",{className:"leave-without-saving"},o.createElement(l.Z,null,o.createElement("h1",null,"Leave without saving"),o.createElement("p",null,"Your changes have not been saved. If you leave now, you will lose your changes."),o.createElement(u.Z,{onClick:t,buttonStyle:"secondary"},"Stay on this page"),o.createElement(u.Z,{onClick:e},"Leave anyway")))))}},82949:(e,t,n)=>{e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(1),i=(o=s)&&o.__esModule?o:{default:o},l=n(2);var u={action:null,isActive:!1,nextLocation:null},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._prevUserAction="",n._isMounted=!0,n.block=n.block.bind(n),n.onBeforeUnload=n.onBeforeUnload.bind(n),n.onCancel=n.onCancel.bind(n),n.onConfirm=n.onConfirm.bind(n),n.when=n.when.bind(n),n.state=a({},u,{unblock:function(){}}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidMount",value:function(){this.props.disableNative||window.addEventListener("beforeunload",this.onBeforeUnload),this.setState({unblock:this.props.history.block(this.block)})}},{key:"componentDidUpdate",value:function(e,t){"CANCEL"===this._prevUserAction&&"function"==typeof this.props.afterCancel?this.props.afterCancel():"CONFIRM"===this._prevUserAction&&"function"==typeof this.props.afterConfirm&&this.props.afterConfirm(),this._prevUserAction=""}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,"CONFIRM"===this._prevUserAction&&"function"==typeof this.props.afterConfirm&&(this._prevUserAction="",this.props.afterConfirm()),this.state.unblock(),this.props.disableNative||window.removeEventListener("beforeunload",this.onBeforeUnload)}},{key:"block",value:function(e,t){var n=this.when(e,t);return n&&this.setState({action:t,nextLocation:e,isActive:!0}),!n}},{key:"navigateToNextLocation",value:function(e){var t=this,n=this.state,o=n.action,r=n.nextLocation;o={POP:this.props.allowGoBack?"goBack":"push",PUSH:"push",REPLACE:"replace"}[o||"PUSH"],r||(r={pathname:"/"});var s=this.props.history;if(this.state.unblock(),this._prevUserAction="CONFIRM","goBack"===o){var i=s.listen((function(){i(),t._isMounted&&t.setState(a({},u,{unblock:s.block(t.block)}))}));s.goBack()}else s[o](r),this._isMounted&&this.setState(a({},u,{unblock:this.props.history.block(this.block)}))}},{key:"onCancel",value:function(){var e=this;(this.props.beforeCancel||function(e){e()})((function(){e._prevUserAction="CANCEL",e.setState(a({},u))}))}},{key:"onConfirm",value:function(){var e=this;(this.props.beforeConfirm||function(e){e()})((function(){e.navigateToNextLocation(e.props.afterConfirm)}))}},{key:"onBeforeUnload",value:function(e){if(this.when()){var t="Do you want to leave this site?\n\nChanges you made may not be saved.";return e.returnValue=t,t}}},{key:"when",value:function(e,t){return"function"==typeof this.props.when?this.props.when(this.props.location,e,t):this.props.when}},{key:"render",value:function(){return this.state.isActive||this.props.renderIfNotActive?i.default.createElement("div",null,this.props.children({isActive:this.state.isActive,onConfirm:this.onConfirm,onCancel:this.onCancel})):null}}]),t}(i.default.Component);t.default=(0,l.withRouter)(c)},function(e,t){e.exports=n(67294)},function(e,t){e.exports=n(73727)}])}}]);