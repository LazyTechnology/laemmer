"use strict";(self.webpackChunkpayload_nextjs_server=self.webpackChunkpayload_nextjs_server||[]).push([[995],{38398:(e,t,l)=>{l.d(t,{Z:()=>s});var a=l(67294),n=l(3902),i=l(39006);const s=e=>{const{useAsTitle:t,title:l,data:s,fallback:r="[untitled]"}=e,o=(0,n.Z)(t);let c=s&&s[t];c||(c=o),c||(c=null==s?void 0:s.id),c||(c=r),c=l||c;return c===(null==s?void 0:s.id)?a.createElement(i.Z,{id:null==s?void 0:s.id}):a.createElement("span",{className:"render-title"},c)}},73588:(e,t,l)=>{l.d(t,{Z:()=>C});var a=l(67294),n=l(39249),i=l(9980),s=l(28571),r=l(76067),o=l(75212),c=l(77329),d=l(74007),u=l(64012),m=l(44586),v=l(48170),p=l(953),E=l(19410),f=l(35193),y=l(71851),g=l(39599);l(25891);const h=e=>{const{setKey:t,highlightField:l}=e,{toggle:i}=(0,y.useModal)(),s="generate-confirmation";return a.createElement(a.Fragment,null,a.createElement(c.Z,{size:"small",buttonStyle:"secondary",onClick:()=>{i(s)}},"Generate new API key"),a.createElement(y.Modal,{slug:s,className:"generate-confirmation"},a.createElement(g.Z,null,a.createElement("h1",null,"Confirm Generation"),a.createElement("p",null,"Generating a new API key will"," ",a.createElement("strong",null,"invalidate")," ","the previous key."," ","Are you sure you wish to continue?"),a.createElement(c.Z,{buttonStyle:"secondary",type:"button",onClick:()=>{i(s)}},"Cancel"),a.createElement(c.Z,{onClick:()=>{t(),i(s),n.Am.success("New API Key Generated.",{autoClose:3e3}),l(!0)}},"Generate"))))},$="apiKey",b=e=>(0,f.text)(e,{minLength:24,maxLength:48,data:{},siblingData:{}}),Z=()=>{const[e,t]=(0,a.useState)(null),[l,n]=(0,a.useState)(!1),{getField:i}=(0,u.useWatchForm)(),s=i($),r=null==s?void 0:s.value,o=(0,a.useMemo)((()=>a.createElement("div",{className:"api-key__label"},a.createElement("span",null,"API Key"),a.createElement(E.Z,{value:r}))),[r]),c=(0,v.Z)({path:"apiKey",validate:b}),{value:d,setValue:f}=c;(0,a.useEffect)((()=>{t((0,m.Z)())}),[]),(0,a.useEffect)((()=>{r||f(e)}),[r,f,e]),(0,a.useEffect)((()=>{l&&setTimeout((()=>{n(!1)}),1e4)}),[l]);const y=["field-type","api-key","read-only"].filter(Boolean).join(" ");return a.createElement(a.Fragment,null,a.createElement("div",{className:y},a.createElement(p.Z,{htmlFor:$,label:o}),a.createElement("input",{value:d||"",className:l?"highlight":void 0,disabled:!0,type:"text",id:"apiKey",name:"apiKey"})),a.createElement(h,{setKey:()=>f((0,m.Z)()),highlightField:()=>{l&&n(!1),setTimeout((()=>{n(!0)}),1)}}))};l(32554);const _="auth-fields",C=e=>{const{useAPIKey:t,requirePassword:l,verify:m,collection:{slug:v},email:p,operation:E}=e,[f,y]=(0,a.useState)(l),{getField:g}=(0,u.useWatchForm)(),h=(0,u.useFormModified)(),$=g("enableAPIKey");(0,a.useEffect)((()=>{h||y(!1)}),[h]);const{serverURL:b,routes:{api:C}}=(0,i.Z)(),k=(0,a.useCallback)((async()=>{const e=`${b}${C}/${v}/unlock`;200===(await fetch(e,{headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p}),method:"post"})).status?n.Am.success("Successfully unlocked",{autoClose:3e3}):n.Am.error("Successfully unlocked")}),[b,C,v,p]);return a.createElement("div",{className:_},a.createElement(s.Z,{required:!0,name:"email",label:"Email",admin:{autoComplete:"email"}}),(f||l)&&a.createElement("div",{className:"auth-fields__changing-password"},a.createElement(r.Z,{autoComplete:"off",required:!0,name:"password",label:"New Password"}),a.createElement(d.Z,null),!l&&a.createElement(c.Z,{size:"small",buttonStyle:"secondary",onClick:()=>y(!1)},"Cancel")),!f&&!l&&a.createElement(c.Z,{size:"small",buttonStyle:"secondary",onClick:()=>y(!0)},"Change Password"),"update"===E&&a.createElement(c.Z,{size:"small",buttonStyle:"secondary",onClick:()=>k()},"Force Unlock"),t&&a.createElement("div",{className:"auth-fields__api-key"},a.createElement(o.Z,{label:"Enable API Key",name:"enableAPIKey"}),(null==$?void 0:$.value)&&a.createElement(Z,null)),m&&a.createElement(o.Z,{label:"Verified",name:"_verified"}))}},5995:(e,t,l)=>{l.r(t),l.d(t,{default:()=>H});var a=l(67294),n=l(5977),i=l(9980),s=l(28630),r=l(75091),o=l(47489),c=l(2143),d=l(73727),u=l(49546),m=l(28584),v=l(93313),p=l(40829),E=l(4983),f=l(46268),y=l(61439),g=l(19410),h=l(77329),$=l(64012);l(79280);const b=({slug:e})=>{const{push:t}=(0,n.k6)(),{getData:l}=(0,$.useForm)(),{routes:{admin:s}}=(0,i.Z)(),r=(0,a.useCallback)((()=>{const a=l();t({pathname:`${s}/collections/${e}/create`,state:{data:a}})}),[t,l,e,s]);return a.createElement(h.Z,{buttonStyle:"none",className:"duplicate",onClick:r},"Duplicate")};var Z=l(39249),_=l(71851),C=l(39599),k=l(3902),w=l(93780);l(78612);const A="delete-document",S=e=>{const{title:t,id:l,collection:{admin:{useAsTitle:s},slug:r,labels:{singular:o}={}}={}}=e,{serverURL:c,routes:{api:d,admin:u}}=(0,i.Z)(),{setModified:m}=(0,$.useForm)(),[v,p]=(0,a.useState)(!1),{closeAll:E,toggle:f}=(0,_.useModal)(),y=(0,n.k6)(),g=(0,k.Z)(s)||l,b=t||g,S=`delete-${l}`,N=(0,a.useCallback)((()=>{Z.Am.error(`There was an error while deleting ${g}. Please check your connection and try again.`)}),[g]),P=(0,a.useCallback)((()=>{p(!0),m(!1),w.E.delete(`${c}${d}/${r}/${l}`,{headers:{"Content-Type":"application/json"}}).then((async e=>{try{const t=await e.json();return e.status<400?(E(),Z.Am.success(`${o} "${g}" successfully deleted.`),y.push(`${u}/collections/${r}`)):(E(),t.errors?t.errors.forEach((e=>Z.Am.error(e.message))):N(),!1)}catch(e){return N()}}))}),[N,E,y,l,o,r,g,u,d,c,m]);return l?a.createElement(a.Fragment,null,a.createElement("button",{type:"button",className:"delete-document__toggle",onClick:e=>{e.preventDefault(),p(!1),f(S)}},"Delete"),a.createElement(_.Modal,{slug:S,className:A},a.createElement(C.Z,null,a.createElement("h1",null,"Confirm deletion"),a.createElement("p",null,"You are about to delete the"," ",o," ",'"',a.createElement("strong",null,b),'". Are you sure?'),a.createElement(h.Z,{buttonStyle:"secondary",type:"button",onClick:v?void 0:()=>f(S)},"Cancel"),a.createElement(h.Z,{onClick:v?void 0:P},v?"Deleting...":"Confirm")))):null};var N=l(10448),P=l(72570),F=l(38398),L=l(50854),U=l(73588),R=l(8742),D=l(56054),K=l(17095),T=l(24531),I=l(11750),M=l(8792),V=l(45074),j=l(9684);l(37841);const x="collection-edit",G=e=>{var t,l,s,r,o,c,h,$,Z,_,C,k,w,A,G,q,z,B;const{params:{id:O}={}}=(0,n.$B)(),{admin:{dateFormat:W},routes:{admin:H}}=(0,i.Z)(),{publishedDoc:J}=(0,V.x5)(),{collection:Y,isEditing:Q,data:X,onSave:ee,permissions:te,isLoading:le,initialState:ae,apiURL:ne,action:ie,hasSavePermission:se}=e,{slug:re,fields:oe,admin:{useAsTitle:ce,disableDuplicate:de,preview:ue,hideAPIURL:me},versions:ve,timestamps:pe,auth:Ee,upload:fe}=Y,ye=[x,Q&&`${x}--is-editing`].filter(Boolean).join(" "),ge=Q?"update":"create";return a.createElement("div",{className:ye},le&&a.createElement(p.Z,null),!le&&a.createElement(j.R.Provider,{value:ge},a.createElement(v.Z,{className:`${x}__form`,method:O?"put":"post",action:ie,onSuccess:ee,disabled:!se,initialState:ae},a.createElement("div",{className:`${x}__main`},a.createElement(N.Z,{title:`${Q?"Editing":"Creating"} - ${Y.labels.singular}`,description:`${Q?"Editing":"Creating"} - ${Y.labels.singular}`,keywords:`${Y.labels.singular}, Payload, CMS`}),a.createElement(m.Z,null),!((null===(t=Y.versions)||void 0===t?void 0:t.drafts)&&(null===(s=null===(l=Y.versions)||void 0===l?void 0:l.drafts)||void 0===s?void 0:s.autosave))&&a.createElement(L.Z,null),a.createElement("div",{className:`${x}__edit`},a.createElement("header",{className:`${x}__header`},a.createElement("h1",null,a.createElement(F.Z,{data:X,useAsTitle:ce,fallback:"[Untitled]"}))),Ee&&a.createElement(U.Z,{useAPIKey:Ee.useAPIKey,requirePassword:!Q,verify:Ee.verify,collection:Y,email:null==X?void 0:X.email,operation:ge}),fe&&a.createElement(D.Z,{data:X,collection:Y}),a.createElement(y.Z,{readOnly:!se,permissions:te.fields,filter:e=>{var t,l;return!(null===(t=null==e?void 0:e.admin)||void 0===t?void 0:t.position)||"sidebar"!==(null===(l=null==e?void 0:e.admin)||void 0===l?void 0:l.position)},fieldTypes:P.Z,fieldSchema:oe}))),a.createElement("div",{className:`${x}__sidebar-wrap`},a.createElement("div",{className:`${x}__sidebar`},a.createElement("div",{className:`${x}__sidebar-sticky-wrap`},a.createElement("ul",{className:`${x}__collection-actions`},(null===(r=null==te?void 0:te.create)||void 0===r?void 0:r.permission)&&a.createElement(a.Fragment,null,a.createElement("li",null,a.createElement(d.Link,{to:`${H}/collections/${re}/create`},"Create New")),!de&&a.createElement("li",null,a.createElement(b,{slug:re}))),(null===(o=null==te?void 0:te.delete)||void 0===o?void 0:o.permission)&&a.createElement("li",null,a.createElement(S,{collection:Y,id:O}))),a.createElement("div",{className:`${x}__document-actions${(null===(c=Y.versions)||void 0===c?void 0:c.drafts)&&!(null===($=null===(h=Y.versions)||void 0===h?void 0:h.drafts)||void 0===$?void 0:$.autosave)||Q&&ue?` ${x}__document-actions--has-2`:""}`},ue&&(!(null===(Z=Y.versions)||void 0===Z?void 0:Z.drafts)||(null===(C=null===(_=Y.versions)||void 0===_?void 0:_.drafts)||void 0===C?void 0:C.autosave))&&a.createElement(E.Z,{generatePreviewURL:ue,data:X}),se&&a.createElement(a.Fragment,null,(null===(k=Y.versions)||void 0===k?void 0:k.drafts)&&a.createElement(a.Fragment,null,!Y.versions.drafts.autosave&&a.createElement(M.Z,null),a.createElement(I.Z,null)),!(null===(w=Y.versions)||void 0===w?void 0:w.drafts)&&a.createElement(f.Z,null,"Save"))),a.createElement("div",{className:`${x}__sidebar-fields`},Q&&ue&&(null===(A=Y.versions)||void 0===A?void 0:A.drafts)&&!(null===(q=null===(G=Y.versions)||void 0===G?void 0:G.drafts)||void 0===q?void 0:q.autosave)&&a.createElement(E.Z,{generatePreviewURL:ue,data:X}),(null===(z=Y.versions)||void 0===z?void 0:z.drafts)&&a.createElement(a.Fragment,null,a.createElement(T.Z,null),(null===(B=Y.versions)||void 0===B?void 0:B.drafts.autosave)&&se&&a.createElement(K.Z,{publishedDocUpdatedAt:(null==J?void 0:J.updatedAt)||(null==X?void 0:X.createdAt),collection:Y,id:O})),a.createElement(y.Z,{readOnly:!se,permissions:te.fields,filter:e=>{var t;return"sidebar"===(null===(t=null==e?void 0:e.admin)||void 0===t?void 0:t.position)},fieldTypes:P.Z,fieldSchema:oe})),Q&&a.createElement("ul",{className:`${x}__meta`},!me&&a.createElement("li",{className:`${x}__api-url`},a.createElement("span",{className:`${x}__label`},"API URL"," ",a.createElement(g.Z,{value:ne})),a.createElement("a",{href:ne,target:"_blank",rel:"noopener noreferrer"},ne)),ve&&a.createElement("li",null,a.createElement("div",{className:`${x}__label`},"Versions"),a.createElement(R.Z,{collection:Y,id:O})),pe&&a.createElement(a.Fragment,null,X.updatedAt&&a.createElement("li",null,a.createElement("div",{className:`${x}__label`},"Last Modified"),a.createElement("div",null,(0,u.default)(new Date(X.updatedAt),W))),((null==J?void 0:J.createdAt)||(null==X?void 0:X.createdAt))&&a.createElement("li",null,a.createElement("div",{className:`${x}__label`},"Created"),a.createElement("div",null,(0,u.default)(new Date((null==J?void 0:J.createdAt)||(null==X?void 0:X.createdAt)),W)))))))))))};var q=l(83780);const z=(e,t)=>t?e.fields.filter((e=>(0,q.fieldAffectsData)(e)&&"id"!==e.name||!0)):e.fields;var B=l(19826),O=l(60161),W=l(40684);const H=e=>{var t,l,d;const{collection:u,isEditing:m}=e,{slug:v,labels:{plural:p},admin:{useAsTitle:E,components:{views:{Edit:f}={}}={}}={}}=u,[y]=(0,a.useState)((()=>z(u,m))),[g]=(0,a.useState)((()=>({...u,fields:y}))),h=(0,W.bU)(),{serverURL:$,routes:{admin:b,api:Z}}=(0,i.Z)(),{params:{id:_}={}}=(0,n.$B)(),{state:C}=(0,n.TH)(),k=(0,n.k6)(),{setStepNav:w}=(0,r.FP)(),[A,S]=(0,a.useState)({}),{permissions:N,user:P}=(0,s.a)(),{getVersions:F}=(0,V.x5)(),L=(0,a.useCallback)((async e=>{var t;if(F(),m){const t=await(0,B.Z)({fieldSchema:g.fields,data:e.doc,user:P,id:_,operation:"update",locale:h});S(t)}else k.push(`${b}/collections/${g.slug}/${null===(t=null==e?void 0:e.doc)||void 0===t?void 0:t.id}`)}),[b,g,k,m,F,P,_,h]),[{data:U,isLoading:R,isError:D}]=(0,o.Z)(m?`${$}${Z}/${v}/${_}`:null,{initialParams:{"fallback-locale":"null",depth:0,draft:"true"}}),K=(null==C?void 0:C.data)||U;if((0,a.useEffect)((()=>{const e=[{url:`${b}/collections/${v}`,label:p}];if(m){let t="";K&&(t=E?K[E]?K[E]:"[Untitled]":K.id),e.push({label:t})}else e.push({label:"Create New"});w(e)}),[w,m,p,K,v,E,b]),(0,a.useEffect)((()=>{if(R)return;(async()=>{const e=await(0,B.Z)({fieldSchema:y,data:K,user:P,operation:m?"update":"create",id:_,locale:h});S(e)})()}),[K,y,m,_,P,h,R]),D)return a.createElement(n.l_,{to:`${b}/not-found`});const T=null===(t=null==N?void 0:N.collections)||void 0===t?void 0:t[v],I=`${$}${Z}/${v}/${_}${g.versions.drafts?"?draft=true":""}`,M=`${$}${Z}/${v}${m?`/${_}`:""}?locale=${h}&depth=0&fallback-locale=null`,j=m&&(null===(l=null==T?void 0:T.update)||void 0===l?void 0:l.permission)||!m&&(null===(d=null==T?void 0:T.create)||void 0===d?void 0:d.permission);return a.createElement(O.S,{allow:!0},a.createElement(c.Z,{DefaultComponent:G,CustomComponent:f,componentProps:{isLoading:R,data:K,collection:g,permissions:T,isEditing:m,onSave:L,initialState:A,hasSavePermission:j,apiURL:I,action:M}}))}},3902:(e,t,l)=>{l.d(t,{Z:()=>n});var a=l(64012);const n=e=>{const{getField:t}=(0,a.useWatchForm)(),l=t(e);return null==l?void 0:l.value}},44586:(e,t,l)=>{var a;l.d(t,{Z:()=>u});var n=new Uint8Array(16);function i(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(n)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const r=function(e){return"string"==typeof e&&s.test(e)};for(var o=[],c=0;c<256;++c)o.push((c+256).toString(16).substr(1));const d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase();if(!r(l))throw TypeError("Stringified UUID is invalid");return l};const u=function(e,t,l){var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){l=l||0;for(var n=0;n<16;++n)t[l+n]=a[n];return t}return d(a)}}}]);